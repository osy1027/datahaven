<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Stage 2</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Dongle&display=swap" rel="stylesheet">

    <style>
        .dongle-regular {
            font-family: "Dongle", sans-serif;
            font-weight: 400;
            font-style: normal;
        }

        body {
            margin: 0;
            padding: 0;
            background-image: url("assets/mini_bg.png");
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            font-family: dongle;

        }

        .stage2-wrapper {
            position: relative;
            width: 1600px;
            height: 1000px;
            margin: 0 auto;
        }

        .stage-bg {
            width: 100%;
            position: absolute;
            top: 10px;
            left: 0;
            z-index: 1;
        }

        .section {
            position: absolute;
            width: 100px;
            height: 100px;
            z-index: 5;
        }

        input.real-input {
            opacity: 0;
            position: absolute;
            width: 200px;
            pointer-events: auto;
            border: none;
            outline: none;
        }

        .fake-text {
            position: absolute;
            width: 200px;
            font-size: 14px;
            color: #ef8ec7;
            display: flex;
            align-items: center;
            user-select: none;
            pointer-events: none;
        }

        .caret {
            width: 2px;
            height: 1em;
            background: #ef8ec7;
            margin-left: 3px;
            animation: blink 0.7s steps(1) infinite;
        }

        @keyframes blink { 50% { opacity: 0; } }

        .submit-btn {
            width: 70px;
            height: 30px;
            opacity: 0;
            background: transparent;
            border: none;
            cursor: pointer;
            position: absolute;
        }

        .doubt {
            color:#ef8ec7;
            font-size:14px;
            width: 250px;
            line-height: 1.4;
            position: absolute;
        }

        .hint {
            color:#ef8ec7;
            font-size:14px;
            width:350px;
            line-height:1.4;
            position:absolute;
        }

        .hidden { display:none; }

        .crazy {
            animation: crazyShake 0.4s infinite,
                       crazyPulse 1s infinite alternate,
                       crazyGlow 1.2s infinite alternate;
        }

        @keyframes crazyShake {
            0% { transform: rotate(0deg); }
            25% { transform: rotate(3deg); }
            50% { transform: rotate(-3deg); }
            75% { transform: rotate(3deg); }
            100% { transform: rotate(0deg); }
        }
        @keyframes crazyPulse {
            0% { font-size: 15px; }
            100% { font-size: 25px; }
        }
        @keyframes crazyGlow {
            0% { text-shadow: 0 0 4px #ff6bff; }
            100% { text-shadow: 0 0 12px #ff00ea, 0 0 20px #ff73ff; }
        }

        .fade-out { animation: fadeOut 0.7s forwards; }
        @keyframes fadeOut { to { opacity:0; } }
    </style>
</head>

<body>

<div class="stage2-wrapper">

    <img src="assets/stage2bg.png" class="stage-bg">

    <!â€” â­ ì§ˆë¬¸ 1 â€”>
    <div class="section" id="q1" style="top: 250px; left: 350px;">

        <p id="q1doubt" class="doubt"
           style="top:-22px; left:440px;">
           ì–´ì„œ ë¹¨ë¦¬ ì•Œë ¤ì¤˜!<br>ê¸°ë‹¤ë¦¬ê³  ìˆë‹¨ ë§ì´ì•¼!
        </p>

        <div id="q1fake" class="fake-text" style="top:0px; left:120px;">
            <span class="text" id="q1text"></span><span class="caret"></span>
        </div>

        <input id="q1input" class="real-input"
               style="top:0px; left:120px;">

        <button id="q1btn" class="submit-btn"
                style="top:65px; left:140px;"></button>

        <p id="q1hint" class="hint"
           style="top:170px; left:700px;">
           ë„¤ê°€ ë­˜ ì¢‹ì•„í•˜ëŠ”ì§€<br>ë„ˆë¬´ ê¶ê¸ˆí•´!
        </p>
    </div>


   <!-- â­ ì§ˆë¬¸ 2 -->
<div class="section hidden" id="q2" style="top: 480px; left: 350px;">

    <p id="q2doubt" class="doubt"
       style="top:-250px; left:440px;">
       ì–´ì„œ ë¹¨ë¦¬ ì•Œë ¤ì¤˜!<br>ê¸°ë‹¤ë¦¬ê³  ìˆë‹¨ ë§ì´ì•¼!
    </p>

    <div id="q2fake" class="fake-text" style="top:-30px; left:120px;">
        <span class="text" id="q2text"></span><span class="caret"></span>
    </div>

    <!-- â›” ê¸°ì¡´ì—ëŠ” top:17px ì´ì—ˆìŒ â†’ â— fakeì™€ ë™ì¼í•œ ìœ„ì¹˜ë¡œ ë³€ê²½ -->
    <input id="q2input" class="real-input"
           style="top:-30px; left:120px;">

    <button id="q2btn" class="submit-btn"
            style="top:35px; left:140px;"></button>

    <p id="q2hint" class="hint"
       style="top:-60px; left:700px;">
       ë„¤ê°€ ë­˜ ì¢‹ì•„í•˜ëŠ”ì§€<br>ë„ˆë¬´ ê¶ê¸ˆí•´!
    </p>
</div>



    <!-- â­ ì§ˆë¬¸ 3 -->
    <div class="section hidden" id="q3" style="top: 710px; left: 350px;">

        <p id="q3doubt" class="doubt dongle-regular"
           style="top:-480px; left:440px;">
           ì–´ì„œ ë¹¨ë¦¬ ì•Œë ¤ì¤˜!<br>ê¸°ë‹¤ë¦¬ê³  ìˆë‹¨ ë§ì´ì•¼!
        </p>

        <div id="q3fake" class="fake-text" style="top:-60px; left:120px;">
            <span class="text" id="q3text"></span><span class="caret"></span>
        </div>

        <input id="q3input" class="real-input"
               style="top:-60px; left:120px;">

        <button id="q3btn" class="submit-btn"
                style="top:-10px; left:140px;"></button>

        <p id="q3hint" class="hint"
           style="top:-280px; left:700px;">
           ë„¤ê°€ ë­˜ ì¢‹ì•„í•˜ëŠ”ì§€<br>ë„ˆë¬´ ê¶ê¸ˆí•´!
        </p>
    </div>

    <audio id="wrongSound" src="assets/wrong.mp3"></audio>

</div>


<script>
    console.log('ffdfdfdfsd')
document.addEventListener("DOMContentLoaded", () => {

    const wrongSound = document.getElementById("wrongSound");

    function bindFake(inputId, fakeId) {
        const input = document.getElementById(inputId);
        const t = document.querySelector(`#${fakeId} .text`);

        input.addEventListener("input", () => t.textContent = input.value);
        document.getElementById(fakeId).addEventListener("click", () => input.focus());
    }

    bindFake("q1input", "q1fake");
    bindFake("q2input", "q2fake");
    bindFake("q3input", "q3fake");

    const attempts = { q1:0, q2:0, q3:0 };
    

    const hintsMap = {
        q1: [
            ["ì•ê¸€ìëŠ” â€˜ë‘â€™. ë””ì €íŠ¸", "ëŠë‚Œ ë‚˜ëŠ” ë‹¨ì–´ì•¼!"],
            ["â€˜ë‘ë°”ì´â€™ì™€ ê´€ë ¨ ìˆì–´.", "ë„ì‹œ ì´ë¦„ì´ ë“¤ì–´ê°€!"],
            ["ì«€ë“ì«€ë“í•œ ì‹ê°â€¦", "ì´ì œ ì •ë§ ë‹¤ ì™”ì–´."],
            ["ê±°ì˜ ë‹¤ ì™”ì–´!", "ë‘ë°”ì´ì«€ë“ì¿ í‚¤!"]
        ],
        q2: [
            ["â€˜ë¡œâ€™ë¡œ ì‹œì‘í•´.", "ë¼ë©´ ëŠë‚Œ ë‚˜ëŠ” ìŒì‹ì´ì•¼."],
            ["ë§¤ìš´ ë¼ë©´ ê³„ì—´.", "ë¶ˆë‹­ ê³„ì—´!"],
            ["ë¶ˆë‹­ + ë‚©ì‘ë‹¹ë©´.", "íŒíŠ¸ ê±°ì˜ ë‹¤ ì¤¬ë‹¤â€¦"],
            ["ë§ˆì§€ë§‰ íŒíŠ¸!", "ë¡œì œë¶ˆë‹­ë‚©ì‘ë‹¹ë©´!"]
        ],
        q3: [
            ["ê±¸ê·¸ë£¹ ë…¸ë˜.", "ìš”ì¦˜ ëœ¨ëŠ” íŒ€!"],
            ["ê·¸ë£¹ëª…ì€ ì•„ì¼ë¦¿!", "ê·€ì—½ì§€ ì•Šë‹¤ê³  ì£¼ì¥í•´."],
            ["â€˜ë‚« ííŠ¸â€™ ëŠë‚Œ.", "ê±°ì˜ ë‹¤ ì™”ì–´."],
            ["ë§ˆì§€ë§‰ íŒíŠ¸!", "ì•„ì¼ë¦¿ì˜ â€˜ë‚« ííŠ¸â€™!"]
        ]
    };

    const doubtMessages = [
        ["ê·¸ê²Œ ë„¤ ì·¨í–¥ì´ ë§ì•„â€¦?", "ë‚˜ ì¢€ ì˜ì‹¬ë˜ëŠ”ë°?"],
        ["ë˜ í‹€ë ¸ì–´â€¦", "ì·¨í–¥ ë‹¤ì‹œ ìƒê°í•´ì•¼ í•´"],
        ["ê³„ì† í‹€ë¦¬ë„¤â€¦", "ë„ˆ ë‚˜ ë†€ë¦¬ëŠ” ê±° ì•„ë‹ˆì§€?"],
        ["ì´ ì •ë„ë©´ ë§ì´ì•¼â€¦", "ì·¨í–¥ ì¡°ì‚¬ ë“¤ì–´ê°„ë‹¤"]
    ];

    /* â­ ì •ë‹µ/ì˜¤ë‹µ ì²˜ë¦¬ */
    function handleQuestion(key, inputEl, correct, nextStep) {
        const doubtEl = document.getElementById(key + "doubt");
        const hintEl  = document.getElementById(key + "hint");

        const value = inputEl.value.trim();
        if (!value) return;

        /* â­ ì •ë‹µ */
        if (value === correct) {
            doubtEl.classList.add("hidden");

            hintEl.innerHTML = "ì •ë‹µ! ğŸ˜†<br>ë„ˆ ì •ë§ ì˜ ë§ì·„ë‹¤!";
            hintEl.classList.remove("hidden");
            hintEl.classList.add("crazy");

            /* ğŸ”¥ 3ì´ˆ í›„ ì •ë‹µ íš¨ê³¼ ì‚¬ë¼ì§ */
            setTimeout(() => {
                hintEl.classList.remove("crazy");
                hintEl.classList.add("hidden");

                if(nextStep) nextStep();
            }, 3000);

            return;
        }

        /* âŒ ì˜¤ë‹µ */
        wrongSound.currentTime = 0;
        wrongSound.play();

        // 10ë²ˆ í‹€ë ¸ì„ ì‹œ ì¸í’‹ ë§‰íˆê³  ìë™ìœ¼ë¡œ ì € span ì•ˆì— ìˆë˜ ê±¸ ë‹¤ ì§€ìš°ê³  íƒ€ì´í•‘íš¨ê³¼ì²˜ëŸ¼ í•œê¸€ì í•œê¸€ì ë‚˜ì˜¤ê²Œ í•´ì¤˜
        function autoWrite(span, text, input) {
            console.log(span, text)
            const speed = 200;
            span.textContent = "";

            // íƒ€ì´í•‘ íš¨ê³¼: ë¬¸ìì—´ì„ í•œ ê¸€ìì”© ì¶”ê°€
            const chars = Array.from(String(text));
            let index = 0;

            function typeNext() {
                if (index < chars.length) {
                    span.textContent += chars[index]; // ëˆ„ì  ë Œë”ë§
                    index++;
                    setTimeout(typeNext, speed); // ì†ë„ ì¡°ì ˆ
                }
            }

            typeNext();
            input.value = text;
        }

        attempts[key]++;
        console.log(attempts.q1, attempts.q2, attempts.q3)
        if (attempts.q1 === 10) {
            autoWrite(document.getElementById('q1text'), answers[0], document.getElementById('q1input'));
        }
        if (attempts.q2 === 10) {
            autoWrite(document.getElementById('q2text'), answers[1], document.getElementById('q2input'));
        }
        if (attempts.q3 === 10) {
            autoWrite(document.getElementById('q3text'), answers[2], document.getElementById('q3input'));
        }

        const [d1,d2] = doubtMessages[(attempts[key]-1) % doubtMessages.length];
        const [h1,h2] = hintsMap[key][Math.min(attempts[key]-1, hintsMap[key].length-1)];

        doubtEl.innerHTML = `${d1}<br>${d2}`;
        hintEl.innerHTML  = `${h1}<br>${h2}`;

        doubtEl.classList.remove("hidden");
        hintEl.classList.remove("hidden");
    }

    const answers = ["ë‘ë°”ì´ì«€ë“ì¿ í‚¤", "ë¡œì œë¶ˆë‹­ë‚©ì‘ë‹¹ë©´", "ì•„ì¼ë¦¿ì˜ ë‚« ííŠ¸"];

    document.getElementById("q1btn").addEventListener("click", () => {
        handleQuestion(
            "q1",
            document.getElementById("q1input"),
            answers[0],
            () => document.getElementById("q2").classList.remove("hidden")
        );
    });

    document.getElementById("q2btn").addEventListener("click", () => {
        handleQuestion(
            "q2",
            document.getElementById("q2input"),
            answers[1],
            () => document.getElementById("q3").classList.remove("hidden")
        );
    });

    document.getElementById("q3btn").addEventListener("click", () => {
        handleQuestion(
            "q3",
            document.getElementById("q3input"),
            answers[2],
            () => {
                document.body.classList.add("fade-out");
                setTimeout(()=>location.href="stage3.html",700);
            }
        );
    });

});
</script>
</body>
</html>
